(function(angular){'use strict';spApp.service('mediaDetailsService',['$http','transformRequestAsFormPost',function($http,transformRequestAsFormPost){return{init:function(){$(document).ready(function(){$(".media-details .sizes-details .sizes").on("click","li",function(){var index=$(this).data('index');$(".media-details .sizes-details .sizes li, .media-details .sizes-details .download-btns li").removeClass('active');$(this).addClass('active');$('.media-details .sizes-details .download-btns li[data-index="'+index+'"]').addClass('active').find('.success-msg').hide();});$('.media-details .flex-images').flexImages();});},addToCart:function($event){$event.preventDefault();var elem=$($event.currentTarget);var digitalLink=$event.currentTarget.href;var href=digitalLink.replace("http://","").replace("https://","").split("/");var profileID=href[2];var mediaID=href[3];var data={mode:"add",type:"digital",profileID:profileID,id:profileID,mediaID:mediaID,instantDownloadAvailable:"1",loggedIn:"",uniqueOrderID:uniqueOrderID};if(!loggedIn&&(href[1]=="credits"||href[1]=="subscriptions")){workbox({'page':baseURL+'/workbox.php?mode=requireLogin',mini:true});}else{elem.addClass("loading");$http({method:'POST',url:'/cart-digital.php',transformRequest:transformRequestAsFormPost,data:data,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=UTF-8'}}).success(function(data){$('header.main .cart-count a span').html(data.itemsInCart).css("display","");elem.removeClass("loading");$($event.currentTarget).closest('li.active').find('.success-msg').slideDown();});}},instantDownloadSub:function($event){var elem=$($event.currentTarget);if($('#instantDownloadAvailable').val()==1)
{ga('send','event','button','click','download');window['optimizely']=window['optimizely']||[];window.optimizely.push(["trackEvent","eventDownload"]);var downloadType='sub';var key=elem.attr('key');var gotoLink=baseURL+"/download.php"+"?dlKey="+key;goto(gotoLink);}
else
{elem.attr('disabled','disabled');submitRequestDownloadForm();}},processKeys:function(){if($(".download-btns .subOptions > a").length>0){$(".download-btns .subOptions > a").each(function(index){var i=index,key=$(this);$.ajax({type:"POST",url:"/k_crypt.php",data:{x:'encrypt',q:key.attr("key")}}).done(function(data){key.attr("key",data);});});}},reDownload:function($event){var elem=$($event.currentTarget);ga('send','event','button','click','download');window['optimizely']=window['optimizely']||[];window.optimizely.push(["trackEvent","eventDownload"]);var downloadType='prevDown';var key=elem.attr('key');var gotoLink=baseURL+"/download.php"+"?dlKey="+key;goto(gotoLink);}}}]);})(window.angular);